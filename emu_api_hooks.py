#!/usr/bin/env python
# -*- coding: utf-8 -*-
# Author: By 空道
# Created on 10:19 2022/11/5
from unicorn import *
import struct

def emptyfunc(eh, address, argv, size, userData):
    print(argv)
### libc 中的大部分导出函数进行简单hook,方便后续调试出现异常再进行处理;
exp_apiHooks = {'SHA1Final':emptyfunc,'SHA1Init':emptyfunc,'SHA1Transform':emptyfunc,'SHA1Update':emptyfunc,'abort':emptyfunc,'accept':emptyfunc,'accept4':emptyfunc,'access':emptyfunc,'acct':emptyfunc,'alarm':emptyfunc,'alphasort64':emptyfunc,'android_getaddrinfofornet':emptyfunc,'android_getaddrinfofornetcontext':emptyfunc,'android_gethostbyaddrfornet':emptyfunc,'android_gethostbynamefornet':emptyfunc,'android_set_abort_message':emptyfunc,'arc4random':emptyfunc,'arc4random_buf':emptyfunc,'arc4random_uniform':emptyfunc,'asctime':emptyfunc,'asctime64':emptyfunc,'asctime64_r':emptyfunc,'asctime_r':emptyfunc,'asprintf':emptyfunc,'at_quick_exit':emptyfunc,'atexit':emptyfunc,'atof':emptyfunc,'atol':emptyfunc,'atoll':emptyfunc,'basename':emptyfunc,'basename_r':emptyfunc,'bcopy':emptyfunc,'bind':emptyfunc,'bindresvport':emptyfunc,'brk':emptyfunc,'bsd_signal':emptyfunc,'bsearch':emptyfunc,'btowc':emptyfunc,'bzero':emptyfunc,'c16rtomb':emptyfunc,'c32rtomb':emptyfunc,'cacheflush':emptyfunc,'calloc':emptyfunc,'capget':emptyfunc,'capset':emptyfunc,'cfgetospeed':emptyfunc,'cfmakeraw':emptyfunc,'cfsetospeed':emptyfunc,'cfsetspeed':emptyfunc,'chdir':emptyfunc,'chmod':emptyfunc,'chown':emptyfunc,'chroot':emptyfunc,'clearenv':emptyfunc,'clearerr':emptyfunc,'clearerr_unlocked':emptyfunc,'clock':emptyfunc,'clock_getcpuclockid':emptyfunc,'clock_getres':emptyfunc,'clock_gettime':emptyfunc,'clock_nanosleep':emptyfunc,'clock_settime':emptyfunc,'clone':emptyfunc,'close':emptyfunc,'closedir':emptyfunc,'closelog':emptyfunc,'connect':emptyfunc,'creat64':emptyfunc,'ctime':emptyfunc,'ctime64':emptyfunc,'ctime64_r':emptyfunc,'ctime_r':emptyfunc,'daemon':emptyfunc,'daylight':emptyfunc,'delete_module':emptyfunc,'difftime':emptyfunc,'dirfd':emptyfunc,'dirname':emptyfunc,'dirname_r':emptyfunc,'dlmalloc':emptyfunc,'dlmalloc_usable_size':emptyfunc,'dn_expand':emptyfunc,'drand48':emptyfunc,'dup':emptyfunc,'dup2':emptyfunc,'dup3':emptyfunc,'duplocale':emptyfunc,'endmntent':emptyfunc,'endutent':emptyfunc,'environ':emptyfunc,'epoll_create':emptyfunc,'epoll_create1':emptyfunc,'epoll_ctl':emptyfunc,'epoll_pwait':emptyfunc,'epoll_wait':emptyfunc,'erand48':emptyfunc,'err':emptyfunc,'error':emptyfunc,'error_at_line':emptyfunc,'error_message_count':emptyfunc,'error_one_per_line':emptyfunc,'error_print_progname':emptyfunc,'errx':emptyfunc,'ether_aton':emptyfunc,'ether_aton_r':emptyfunc,'ether_ntoa':emptyfunc,'ether_ntoa_r':emptyfunc,'eventfd':emptyfunc,'eventfd_read':emptyfunc,'eventfd_write':emptyfunc,'execl':emptyfunc,'execle':emptyfunc,'execlp':emptyfunc,'execv':emptyfunc,'execve':emptyfunc,'execvp':emptyfunc,'execvpe':emptyfunc,'exit':emptyfunc,'faccessat':emptyfunc,'fake_gmtime_r':emptyfunc,'fake_localtime_r':emptyfunc,'fallocate':emptyfunc,'fallocate64':emptyfunc,'fchdir':emptyfunc,'fchmod':emptyfunc,'fchmodat':emptyfunc,'fchown':emptyfunc,'fchownat':emptyfunc,'fclose':emptyfunc,'fcntl':emptyfunc,'fdatasync':emptyfunc,'fdopen':emptyfunc,'fdopendir':emptyfunc,'fdprintf':emptyfunc,'feof':emptyfunc,'feof_unlocked':emptyfunc,'ferror':emptyfunc,'ferror_unlocked':emptyfunc,'fflush':emptyfunc,'ffs':emptyfunc,'fgetc':emptyfunc,'fgetln':emptyfunc,'fgetpos':emptyfunc,'fgets':emptyfunc,'fgetwc':emptyfunc,'fgetws':emptyfunc,'fgetxattr':emptyfunc,'fileno':emptyfunc,'flistxattr':emptyfunc,'flock':emptyfunc,'flockfile':emptyfunc,'fmemopen':emptyfunc,'fnmatch':emptyfunc,'fopen':emptyfunc,'fork':emptyfunc,'forkpty':emptyfunc,'fpathconf':emptyfunc,'fprintf':emptyfunc,'fpurge':emptyfunc,'fputc':emptyfunc,'fputs':emptyfunc,'fputwc':emptyfunc,'fputws':emptyfunc,'fread':emptyfunc,'free':emptyfunc,'free_malloc_leak_info':emptyfunc,'freeaddrinfo':emptyfunc,'freelocale':emptyfunc,'fremovexattr':emptyfunc,'freopen':emptyfunc,'fscanf':emptyfunc,'fseek':emptyfunc,'fseeko':emptyfunc,'fsetpos':emptyfunc,'fsetxattr':emptyfunc,'fstat64':emptyfunc,'fstatat64':emptyfunc,'fstatfs64':emptyfunc,'fstatvfs64':emptyfunc,'fsync':emptyfunc,'ftell':emptyfunc,'ftello':emptyfunc,'ftime':emptyfunc,'ftok':emptyfunc,'ftruncate':emptyfunc,'ftruncate64':emptyfunc,'ftrylockfile':emptyfunc,'fts_children':emptyfunc,'fts_close':emptyfunc,'fts_open':emptyfunc,'fts_read':emptyfunc,'fts_set':emptyfunc,'ftw':emptyfunc,'ftw64':emptyfunc,'funlockfile':emptyfunc,'funopen':emptyfunc,'futimens':emptyfunc,'fwide':emptyfunc,'fwprintf':emptyfunc,'fwrite':emptyfunc,'fwscanf':emptyfunc,'gMallocLeakZygoteChild':emptyfunc,'gai_strerror':emptyfunc,'get_avphys_pages':emptyfunc,'get_malloc_leak_info':emptyfunc,'get_nprocs':emptyfunc,'get_nprocs_conf':emptyfunc,'get_phys_pages':emptyfunc,'getaddrinfo':emptyfunc,'getauxval':emptyfunc,'getc':emptyfunc,'getc_unlocked':emptyfunc,'getchar':emptyfunc,'getchar_unlocked':emptyfunc,'getcwd':emptyfunc,'getdelim':emptyfunc,'getdents':emptyfunc,'getdtablesize':emptyfunc,'getegid':emptyfunc,'getenv':emptyfunc,'geteuid':emptyfunc,'getgid':emptyfunc,'getgrgid':emptyfunc,'getgrnam':emptyfunc,'getgrouplist':emptyfunc,'getgroups':emptyfunc,'gethostbyaddr':emptyfunc,'gethostbyaddr_r':emptyfunc,'gethostbyname':emptyfunc,'gethostbyname2':emptyfunc,'gethostbyname2_r':emptyfunc,'gethostbyname_r':emptyfunc,'gethostent':emptyfunc,'gethostname':emptyfunc,'getitimer':emptyfunc,'getline':emptyfunc,'getlogin':emptyfunc,'getmntent':emptyfunc,'getmntent_r':emptyfunc,'getnameinfo':emptyfunc,'getopt':emptyfunc,'getopt_long':emptyfunc,'getopt_long_only':emptyfunc,'getpagesize':emptyfunc,'getpeername':emptyfunc,'getpgid':emptyfunc,'getpgrp':emptyfunc,'getpid':emptyfunc,'getppid':emptyfunc,'getpriority':emptyfunc,'getprogname':emptyfunc,'getpt':emptyfunc,'getpwnam':emptyfunc,'getpwnam_r':emptyfunc,'getpwuid':emptyfunc,'getpwuid_r':emptyfunc,'getresgid':emptyfunc,'getresuid':emptyfunc,'getrlimit':emptyfunc,'getrlimit64':emptyfunc,'getrusage':emptyfunc,'gets':emptyfunc,'getservbyname':emptyfunc,'getservbyport':emptyfunc,'getservent':emptyfunc,'getsid':emptyfunc,'getsockname':emptyfunc,'getsockopt':emptyfunc,'gettid':emptyfunc,'gettimeofday':emptyfunc,'getuid':emptyfunc,'getutent':emptyfunc,'getwc':emptyfunc,'getwchar':emptyfunc,'getxattr':emptyfunc,'gmtime':emptyfunc,'gmtime64':emptyfunc,'gmtime64_r':emptyfunc,'gmtime_r':emptyfunc,'herror':emptyfunc,'hstrerror':emptyfunc,'if_indextoname':emptyfunc,'if_nametoindex':emptyfunc,'index':emptyfunc,'inet_addr':emptyfunc,'inet_aton':emptyfunc,'inet_lnaof':emptyfunc,'inet_makeaddr':emptyfunc,'inet_netof':emptyfunc,'inet_network':emptyfunc,'inet_nsap_addr':emptyfunc,'inet_nsap_ntoa':emptyfunc,'inet_ntoa':emptyfunc,'inet_ntop':emptyfunc,'inet_pton':emptyfunc,'init_module':emptyfunc,'initgroups':emptyfunc,'initstate':emptyfunc,'inotify_add_watch':emptyfunc,'inotify_init':emptyfunc,'inotify_init1':emptyfunc,'inotify_rm_watch':emptyfunc,'insque':emptyfunc,'ioctl':emptyfunc,'isalnum':emptyfunc,'isalpha':emptyfunc,'isascii':emptyfunc,'isatty':emptyfunc,'isblank':emptyfunc,'iscntrl':emptyfunc,'isdigit':emptyfunc,'isfinitef':emptyfunc,'isfinitel':emptyfunc,'isgraph':emptyfunc,'isinff':emptyfunc,'isinfl':emptyfunc,'islower':emptyfunc,'isnanf':emptyfunc,'isnanl':emptyfunc,'isnormalf':emptyfunc,'isnormall':emptyfunc,'isprint':emptyfunc,'ispunct':emptyfunc,'isspace':emptyfunc,'isupper':emptyfunc,'iswalnum':emptyfunc,'iswalnum_l':emptyfunc,'iswalpha':emptyfunc,'iswalpha_l':emptyfunc,'iswblank':emptyfunc,'iswblank_l':emptyfunc,'iswcntrl':emptyfunc,'iswcntrl_l':emptyfunc,'iswctype':emptyfunc,'iswctype_l':emptyfunc,'iswdigit':emptyfunc,'iswdigit_l':emptyfunc,'iswgraph':emptyfunc,'iswgraph_l':emptyfunc,'iswlower':emptyfunc,'iswlower_l':emptyfunc,'iswprint':emptyfunc,'iswprint_l':emptyfunc,'iswpunct':emptyfunc,'iswpunct_l':emptyfunc,'iswspace':emptyfunc,'iswspace_l':emptyfunc,'iswupper':emptyfunc,'iswupper_l':emptyfunc,'iswxdigit_l':emptyfunc,'isxdigit':emptyfunc,'isxdigit_l':emptyfunc,'jrand48':emptyfunc,'kill':emptyfunc,'killpg':emptyfunc,'klogctl':emptyfunc,'labs':emptyfunc,'lchown':emptyfunc,'lcong48':emptyfunc,'ldexp':emptyfunc,'ldiv':emptyfunc,'lfind':emptyfunc,'lgetxattr':emptyfunc,'link':emptyfunc,'linkat':emptyfunc,'listen':emptyfunc,'listxattr':emptyfunc,'llabs':emptyfunc,'lldiv':emptyfunc,'llistxattr':emptyfunc,'localeconv':emptyfunc,'localtime':emptyfunc,'localtime64':emptyfunc,'localtime64_r':emptyfunc,'localtime_r':emptyfunc,'login_tty':emptyfunc,'lrand48':emptyfunc,'lremovexattr':emptyfunc,'lsearch':emptyfunc,'lseek':emptyfunc,'lseek64':emptyfunc,'lsetxattr':emptyfunc,'lstat64':emptyfunc,'madvise':emptyfunc,'mallinfo':emptyfunc,'malloc':emptyfunc,'malloc_info':emptyfunc,'malloc_usable_size':emptyfunc,'mbrlen':emptyfunc,'mbrtoc16':emptyfunc,'mbrtoc32':emptyfunc,'mbrtowc':emptyfunc,'mbsinit':emptyfunc,'mbsnrtowcs':emptyfunc,'mbsrtowcs':emptyfunc,'mbstowcs':emptyfunc,'mbtowc':emptyfunc,'memalign':emptyfunc,'memccpy':emptyfunc,'memchr':emptyfunc,'memcmp':emptyfunc,'memcpy':emptyfunc,'memmem':emptyfunc,'memmove':emptyfunc,'mempcpy':emptyfunc,'memrchr':emptyfunc,'memset':emptyfunc,'memswap':emptyfunc,'mincore':emptyfunc,'mkdir':emptyfunc,'mkdirat':emptyfunc,'mkdtemp':emptyfunc,'mkfifo':emptyfunc,'mkfifoat':emptyfunc,'mknod':emptyfunc,'mknodat':emptyfunc,'mkostemp':emptyfunc,'mkostemp64':emptyfunc,'mkostemps':emptyfunc,'mkostemps64':emptyfunc,'mkstemp':emptyfunc,'mkstemp64':emptyfunc,'mkstemps':emptyfunc,'mkstemps64':emptyfunc,'mktemp':emptyfunc,'mktime':emptyfunc,'mktime64':emptyfunc,'mktime_tz':emptyfunc,'mlock':emptyfunc,'mlockall':emptyfunc,'mmap':emptyfunc,'mmap64':emptyfunc,'mount':emptyfunc,'mprotect':emptyfunc,'mrand48':emptyfunc,'mremap':emptyfunc,'msync':emptyfunc,'munlock':emptyfunc,'munlockall':emptyfunc,'munmap':emptyfunc,'nanosleep':emptyfunc,'newlocale':emptyfunc,'nftw':emptyfunc,'nftw64':emptyfunc,'nice':emptyfunc,'nrand48':emptyfunc,'nsdispatch':emptyfunc,'ntohl':emptyfunc,'ntohs':emptyfunc,'open64':emptyfunc,'open_memstream':emptyfunc,'open_wmemstream':emptyfunc,'openat64':emptyfunc,'opendir':emptyfunc,'openlog':emptyfunc,'openpty':emptyfunc,'optarg':emptyfunc,'opterr':emptyfunc,'optind':emptyfunc,'optopt':emptyfunc,'optreset':emptyfunc,'pathconf':emptyfunc,'pause':emptyfunc,'pclose':emptyfunc,'perror':emptyfunc,'personality':emptyfunc,'pipe':emptyfunc,'pipe2':emptyfunc,'poll':emptyfunc,'popen':emptyfunc,'posix_fadvise':emptyfunc,'posix_fadvise64':emptyfunc,'posix_fallocate':emptyfunc,'posix_fallocate64':emptyfunc,'posix_madvise':emptyfunc,'posix_memalign':emptyfunc,'posix_openpt':emptyfunc,'ppoll':emptyfunc,'prctl':emptyfunc,'pread':emptyfunc,'pread64':emptyfunc,'printf':emptyfunc,'prlimit64':emptyfunc,'process_vm_readv':emptyfunc,'process_vm_writev':emptyfunc,'pselect':emptyfunc,'psiginfo':emptyfunc,'psignal':emptyfunc,'pthread_atfork':emptyfunc,'pthread_attr_destroy':emptyfunc,'pthread_attr_getguardsize':emptyfunc,'pthread_attr_getschedparam':emptyfunc,'pthread_attr_getschedpolicy':emptyfunc,'pthread_attr_getscope':emptyfunc,'pthread_attr_getstack':emptyfunc,'pthread_attr_getstackaddr':emptyfunc,'pthread_attr_getstacksize':emptyfunc,'pthread_attr_init':emptyfunc,'pthread_attr_setdetachstate':emptyfunc,'pthread_attr_setguardsize':emptyfunc,'pthread_attr_setschedparam':emptyfunc,'pthread_attr_setschedpolicy':emptyfunc,'pthread_attr_setscope':emptyfunc,'pthread_attr_setstack':emptyfunc,'pthread_attr_setstackaddr':emptyfunc,'pthread_attr_setstacksize':emptyfunc,'pthread_cond_broadcast':emptyfunc,'pthread_cond_destroy':emptyfunc,'pthread_cond_init':emptyfunc,'pthread_cond_signal':emptyfunc,'pthread_cond_timedwait':emptyfunc,'pthread_cond_timedwait_monotonic':emptyfunc,'pthread_cond_timedwait_monotonic_np':emptyfunc,'pthread_cond_timedwait_relative_np':emptyfunc,'pthread_cond_timeout_np':emptyfunc,'pthread_cond_wait':emptyfunc,'pthread_condattr_destroy':emptyfunc,'pthread_condattr_setclock':emptyfunc,'pthread_condattr_setpshared':emptyfunc,'pthread_create':emptyfunc,'pthread_detach':emptyfunc,'pthread_equal':emptyfunc,'pthread_exit':emptyfunc,'pthread_getattr_np':emptyfunc,'pthread_getcpuclockid':emptyfunc,'pthread_getschedparam':emptyfunc,'pthread_getspecific':emptyfunc,'pthread_gettid_np':emptyfunc,'pthread_join':emptyfunc,'pthread_key_create':emptyfunc,'pthread_key_delete':emptyfunc,'pthread_kill':emptyfunc,'pthread_mutex_destroy':emptyfunc,'pthread_mutex_init':emptyfunc,'pthread_mutex_lock':emptyfunc,'pthread_mutex_lock_timeout_np':emptyfunc,'pthread_mutex_timedlock':emptyfunc,'pthread_mutex_trylock':emptyfunc,'pthread_mutex_unlock':emptyfunc,'pthread_mutexattr_getpshared':emptyfunc,'pthread_mutexattr_gettype':emptyfunc,'pthread_mutexattr_setpshared':emptyfunc,'pthread_mutexattr_settype':emptyfunc,'pthread_once':emptyfunc,'pthread_rwlock_destroy':emptyfunc,'pthread_rwlock_init':emptyfunc,'pthread_rwlock_rdlock':emptyfunc,'pthread_rwlock_timedrdlock':emptyfunc,'pthread_rwlock_timedwrlock':emptyfunc,'pthread_rwlock_tryrdlock':emptyfunc,'pthread_rwlock_trywrlock':emptyfunc,'pthread_rwlock_unlock':emptyfunc,'pthread_rwlock_wrlock':emptyfunc,'pthread_rwlockattr_destroy':emptyfunc,'pthread_rwlockattr_getkind_np':emptyfunc,'pthread_rwlockattr_getpshared':emptyfunc,'pthread_rwlockattr_init':emptyfunc,'pthread_rwlockattr_setkind_np':emptyfunc,'pthread_rwlockattr_setpshared':emptyfunc,'pthread_self':emptyfunc,'pthread_setname_np':emptyfunc,'pthread_setschedparam':emptyfunc,'pthread_setspecific':emptyfunc,'pthread_sigmask':emptyfunc,'ptrace':emptyfunc,'ptsname':emptyfunc,'ptsname_r':emptyfunc,'putc':emptyfunc,'putc_unlocked':emptyfunc,'putchar':emptyfunc,'putchar_unlocked':emptyfunc,'putenv':emptyfunc,'puts':emptyfunc,'pututline':emptyfunc,'putw':emptyfunc,'putwc':emptyfunc,'putwchar':emptyfunc,'pvalloc':emptyfunc,'pwrite':emptyfunc,'pwrite64':emptyfunc,'qsort':emptyfunc,'quick_exit':emptyfunc,'raise':emptyfunc,'rand':emptyfunc,'rand_r':emptyfunc,'random':emptyfunc,'read':emptyfunc,'readahead':emptyfunc,'readdir64':emptyfunc,'readdir_r':emptyfunc,'readlink':emptyfunc,'readlinkat':emptyfunc,'readv':emptyfunc,'realloc':emptyfunc,'realpath':emptyfunc,'reboot':emptyfunc,'recv':emptyfunc,'recvfrom':emptyfunc,'recvmmsg':emptyfunc,'recvmsg':emptyfunc,'regcomp':emptyfunc,'regerror':emptyfunc,'regexec':emptyfunc,'regfree':emptyfunc,'remove':emptyfunc,'removexattr':emptyfunc,'remque':emptyfunc,'rename':emptyfunc,'renameat':emptyfunc,'res_init':emptyfunc,'res_mkquery':emptyfunc,'res_query':emptyfunc,'res_search':emptyfunc,'restore_core_regs':emptyfunc,'rewind':emptyfunc,'rewinddir':emptyfunc,'rmdir':emptyfunc,'sbrk':emptyfunc,'scandir64':emptyfunc,'scanf':emptyfunc,'sched_get_priority_max':emptyfunc,'sched_get_priority_min':emptyfunc,'sched_getaffinity':emptyfunc,'sched_getcpu':emptyfunc,'sched_getparam':emptyfunc,'sched_getscheduler':emptyfunc,'sched_rr_get_interval':emptyfunc,'sched_setaffinity':emptyfunc,'sched_setparam':emptyfunc,'sched_setscheduler':emptyfunc,'sched_yield':emptyfunc,'seed48':emptyfunc,'seekdir':emptyfunc,'select':emptyfunc,'sem_destroy':emptyfunc,'sem_getvalue':emptyfunc,'sem_init':emptyfunc,'sem_open':emptyfunc,'sem_post':emptyfunc,'sem_timedwait':emptyfunc,'sem_trywait':emptyfunc,'sem_unlink':emptyfunc,'sem_wait':emptyfunc,'send':emptyfunc,'sendfile':emptyfunc,'sendfile64':emptyfunc,'sendmmsg':emptyfunc,'sendmsg':emptyfunc,'sendto':emptyfunc,'setbuf':emptyfunc,'setbuffer':emptyfunc,'setegid':emptyfunc,'setenv':emptyfunc,'seteuid':emptyfunc,'setfsgid':emptyfunc,'setfsuid':emptyfunc,'setgid':emptyfunc,'setgroups':emptyfunc,'sethostname':emptyfunc,'setitimer':emptyfunc,'setjmp':emptyfunc,'setlinebuf':emptyfunc,'setlocale':emptyfunc,'setlogmask':emptyfunc,'setmntent':emptyfunc,'setns':emptyfunc,'setpgid':emptyfunc,'setpgrp':emptyfunc,'setpriority':emptyfunc,'setprogname':emptyfunc,'setregid':emptyfunc,'setresgid':emptyfunc,'setresuid':emptyfunc,'setreuid':emptyfunc,'setrlimit':emptyfunc,'setrlimit64':emptyfunc,'setservent':emptyfunc,'setsid':emptyfunc,'setsockopt':emptyfunc,'setstate':emptyfunc,'settimeofday':emptyfunc,'setuid':emptyfunc,'setusershell':emptyfunc,'setutent':emptyfunc,'setvbuf':emptyfunc,'setxattr':emptyfunc,'shutdown':emptyfunc,'sigaction':emptyfunc,'sigaddset':emptyfunc,'sigaltstack':emptyfunc,'sigblock':emptyfunc,'sigdelset':emptyfunc,'sigemptyset':emptyfunc,'sigfillset':emptyfunc,'siginterrupt':emptyfunc,'sigismember':emptyfunc,'siglongjmp':emptyfunc,'signal':emptyfunc,'signalfd':emptyfunc,'sigpending':emptyfunc,'sigprocmask':emptyfunc,'sigqueue':emptyfunc,'sigsetjmp':emptyfunc,'sigsetmask':emptyfunc,'sigsuspend':emptyfunc,'sigtimedwait':emptyfunc,'sigwait':emptyfunc,'sigwaitinfo':emptyfunc,'sleep':emptyfunc,'snprintf':emptyfunc,'socket':emptyfunc,'socketpair':emptyfunc,'splice':emptyfunc,'sprintf':emptyfunc,'srand':emptyfunc,'srand48':emptyfunc,'srandom':emptyfunc,'sscanf':emptyfunc,'stat64':emptyfunc,'statfs64':emptyfunc,'statvfs64':emptyfunc,'stderr':emptyfunc,'stdin':emptyfunc,'stdout':emptyfunc,'stpcpy':emptyfunc,'stpncpy':emptyfunc,'strcasecmp':emptyfunc,'strcasecmp_l':emptyfunc,'strcasestr':emptyfunc,'strcat':emptyfunc,'strchr':emptyfunc,'strcmp':emptyfunc,'strcoll':emptyfunc,'strcoll_l':emptyfunc,'strcpy':emptyfunc,'strcspn':emptyfunc,'strdup':emptyfunc,'strerror':emptyfunc,'strerror_l':emptyfunc,'strerror_r':emptyfunc,'strftime':emptyfunc,'strftime_l':emptyfunc,'strlcat':emptyfunc,'strlcpy':emptyfunc,'strlen':emptyfunc,'strncasecmp':emptyfunc,'strncasecmp_l':emptyfunc,'strncat':emptyfunc,'strncmp':emptyfunc,'strncpy':emptyfunc,'strndup':emptyfunc,'strnlen':emptyfunc,'strntoimax':emptyfunc,'strntoumax':emptyfunc,'strpbrk':emptyfunc,'strptime':emptyfunc,'strrchr':emptyfunc,'strsep':emptyfunc,'strsignal':emptyfunc,'strspn':emptyfunc,'strstr':emptyfunc,'strtod':emptyfunc,'strtof':emptyfunc,'strtok':emptyfunc,'strtok_r':emptyfunc,'strtol':emptyfunc,'strtold':emptyfunc,'strtold_l':emptyfunc,'strtoll_l':emptyfunc,'strtoq':emptyfunc,'strtotimeval':emptyfunc,'strtoul':emptyfunc,'strtoull_l':emptyfunc,'strtouq':emptyfunc,'strxfrm':emptyfunc,'strxfrm_l':emptyfunc,'swapoff':emptyfunc,'swapon':emptyfunc,'swprintf':emptyfunc,'swscanf':emptyfunc,'symlink':emptyfunc,'symlinkat':emptyfunc,'sync':emptyfunc,'sys_siglist':emptyfunc,'sys_signame':emptyfunc,'syscall':emptyfunc,'sysconf':emptyfunc,'sysinfo':emptyfunc,'syslog':emptyfunc,'system':emptyfunc,'sysv_signal':emptyfunc,'tcdrain':emptyfunc,'tcflow':emptyfunc,'tcflush':emptyfunc,'tcgetattr':emptyfunc,'tcgetpgrp':emptyfunc,'tcgetsid':emptyfunc,'tcsendbreak':emptyfunc,'tcsetattr':emptyfunc,'tcsetpgrp':emptyfunc,'tdelete':emptyfunc,'tdestroy':emptyfunc,'tee':emptyfunc,'telldir':emptyfunc,'tempnam':emptyfunc,'tfind':emptyfunc,'tgkill':emptyfunc,'time':emptyfunc,'timegm':emptyfunc,'timegm64':emptyfunc,'timelocal':emptyfunc,'timelocal64':emptyfunc,'timer_create':emptyfunc,'timer_delete':emptyfunc,'timer_getoverrun':emptyfunc,'timer_gettime':emptyfunc,'timer_settime':emptyfunc,'timerfd_create':emptyfunc,'timerfd_gettime':emptyfunc,'timerfd_settime':emptyfunc,'times':emptyfunc,'timezone':emptyfunc,'tkill':emptyfunc,'tmpfile':emptyfunc,'tmpnam':emptyfunc,'toascii':emptyfunc,'tolower':emptyfunc,'toupper':emptyfunc,'towlower':emptyfunc,'towlower_l':emptyfunc,'towupper':emptyfunc,'towupper_l':emptyfunc,'truncate':emptyfunc,'truncate64':emptyfunc,'tsearch':emptyfunc,'ttyname':emptyfunc,'ttyname_r':emptyfunc,'twalk':emptyfunc,'tzname':emptyfunc,'tzset':emptyfunc,'umask':emptyfunc,'umount':emptyfunc,'umount2':emptyfunc,'uname':emptyfunc,'ungetc':emptyfunc,'ungetwc':emptyfunc,'unlink':emptyfunc,'unlinkat':emptyfunc,'unlockpt':emptyfunc,'unsetenv':emptyfunc,'unshare':emptyfunc,'uselocale':emptyfunc,'usleep':emptyfunc,'utime':emptyfunc,'utimensat':emptyfunc,'utimes':emptyfunc,'utmpname':emptyfunc,'valloc':emptyfunc,'vasprintf':emptyfunc,'vdprintf':emptyfunc,'verr':emptyfunc,'verrx':emptyfunc,'vfdprintf':emptyfunc,'vfork':emptyfunc,'vfprintf':emptyfunc,'vfscanf':emptyfunc,'vfwprintf':emptyfunc,'vfwscanf':emptyfunc,'vmsplice':emptyfunc,'vprintf':emptyfunc,'vscanf':emptyfunc,'vsnprintf':emptyfunc,'vsprintf':emptyfunc,'vsscanf':emptyfunc,'vswprintf':emptyfunc,'vswscanf':emptyfunc,'vsyslog':emptyfunc,'vwarn':emptyfunc,'vwarnx':emptyfunc,'vwprintf':emptyfunc,'vwscanf':emptyfunc,'wait':emptyfunc,'wait3':emptyfunc,'wait4':emptyfunc,'waitid':emptyfunc,'waitpid':emptyfunc,'warn':emptyfunc,'warnx':emptyfunc,'wcpcpy':emptyfunc,'wcpncpy':emptyfunc,'wcrtomb':emptyfunc,'wcscasecmp':emptyfunc,'wcscasecmp_l':emptyfunc,'wcscat':emptyfunc,'wcschr':emptyfunc,'wcscmp':emptyfunc,'wcscoll':emptyfunc,'wcscoll_l':emptyfunc,'wcscpy':emptyfunc,'wcscspn':emptyfunc,'wcsdup':emptyfunc,'wcsftime':emptyfunc,'wcslcat':emptyfunc,'wcslcpy':emptyfunc,'wcslen':emptyfunc,'wcsncasecmp':emptyfunc,'wcsncasecmp_l':emptyfunc,'wcsncat':emptyfunc,'wcsncmp':emptyfunc,'wcsncpy':emptyfunc,'wcsnlen':emptyfunc,'wcsnrtombs':emptyfunc,'wcspbrk':emptyfunc,'wcsrchr':emptyfunc,'wcsrtombs':emptyfunc,'wcsspn':emptyfunc,'wcsstr':emptyfunc,'wcstod':emptyfunc,'wcstof':emptyfunc,'wcstoimax':emptyfunc,'wcstok':emptyfunc,'wcstol':emptyfunc,'wcstold':emptyfunc,'wcstold_l':emptyfunc,'wcstoll':emptyfunc,'wcstoll_l':emptyfunc,'wcstombs':emptyfunc,'wcstoul':emptyfunc,'wcstoull':emptyfunc,'wcstoull_l':emptyfunc,'wcstoumax':emptyfunc,'wcswcs':emptyfunc,'wcswidth':emptyfunc,'wcsxfrm':emptyfunc,'wcsxfrm_l':emptyfunc,'wctob':emptyfunc,'wctomb':emptyfunc,'wctype':emptyfunc,'wctype_l':emptyfunc,'wcwidth':emptyfunc,'wmemchr':emptyfunc,'wmemcmp':emptyfunc,'wmemcpy':emptyfunc,'wmemmove':emptyfunc,'wmempcpy':emptyfunc,'wmemset':emptyfunc,'wprintf':emptyfunc,'write':emptyfunc,'writev':emptyfunc,'wscanf':emptyfunc,}

# return a fake handle value
def mallocHook(eh, address, argv, size, userData):
    print("call mallocHook")
    allocSize = argv[0]
    ###设置一个函数静态变量方便累加
    if ( not hasattr(mallocHook,'base')  ):
            mallocHook.base = 0x00600000
    ##查找申请空间的地址
    while(eh.is_memory_mapped(mallocHook.base)):
        mallocHook.base += 0x1000
    addr = eh.map_memory(mallocHook.base, allocSize);
    ##方便下一次基地址获取;
    mallocHook.base +=  (allocSize + 0x1000 - 1) & ~(0x1000 - 1)
    return addr

def memsetHook(eh, address, argv, size, userData):
    print("memsetHook")
    print(argv)
    addr = argv[0]
    chrch = struct.pack("B", argv[1] & 0xff)
    bufsize = argv[2]
    eh.mu.mem_write(addr, chrch * bufsize)
    print("memset addr: 0x%x" % addr)
    return addr
def strcmpHook(eh, address, argv, size, userData):
    print("strcmpHook")
    if eh.is_memory_mapped(argv[0]) and eh.is_memory_mapped(argv[1]):
        str1 = eh.getEmuString(argv[0])
        str2 = eh.getEmuString(argv[1])
        if str1 == str2:
            return 0
    return -1;
def strlenHook(eh, address, argv, size, userData):
    print("strlenHook addr:0x%x" % argv[0])
    if eh.is_memory_mapped(argv[0]):
        str1 = eh.getEmuString(argv[0])
        return len(str1)
    else:
        return 0;
##随便打印一下 printf 的第一个参数;
def printfHook(eh, address, argv, size, userData):
    print("printfHook:%s" % eh.getEmuString(argv[0]))
    print(argv)

## 实现对应方法的代码
exp_apiHooks['malloc'] = mallocHook
exp_apiHooks['memset'] = memsetHook
exp_apiHooks['strcmp'] = strcmpHook
exp_apiHooks['strlen'] = strlenHook
exp_apiHooks['printf'] = printfHook
